(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b8a45b6"],{"5cf7":function(e,t,n){(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)e[s]=n[s]}return e}var t={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function n(t,s){function a(n,a,o){if("undefined"!==typeof document){o=e({},s,o),"number"===typeof o.expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var c in o)o[c]&&(i+="; "+c,!0!==o[c]&&(i+="="+o[c].split(";")[0]));return document.cookie=n+"="+t.write(a,n)+i}}function o(e){if("undefined"!==typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],s={},a=0;a<n.length;a++){var o=n[a].split("="),i=o.slice(1).join("=");try{var c=decodeURIComponent(o[0]);if(s[c]=t.read(i,c),e===c)break}catch(r){}}return e?s[e]:s}}return Object.create({set:a,get:o,remove:function(t,n){a(t,"",e({},n,{expires:-1}))},withAttributes:function(t){return n(this.converter,e({},this.attributes,t))},withConverter:function(t){return n(e({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(t)}})}var s=n(t,{path:"/"});return s}))},"7b2f":function(e,t,n){},8923:function(e,t,n){"use strict";n("7b2f")},"90fe":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var s=n("5cf7"),a=n.n(s);function o(){return a.a.get("Thename")}function i(){return a.a.get("admin")}},9166:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-page"},[n("div",{staticClass:"chat-page-head"},[e._v(" 当前在线人数"+e._s(e.num)+" ")]),n("div",{staticClass:"chat-page-body",attrs:{id:"msg_box"}},[e._l(e.histortist,(function(t,s){return n("div",{key:s,staticClass:"chatMsg"},[t.adm!=e.admin?n("div",{staticClass:"chatMsg-t1"},[e._v(e._s(t.Thename)+"说：")]):e._e(),t.adm!=e.admin?n("div",{staticClass:"chatMsg-t2"},[e._v(e._s(t.updataTime))]):e._e(),t.adm!=e.admin?n("div",{staticClass:"chatMsg-t3"},[e._v(e._s(t.content))]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t1 al gb"},[e._v(e._s(t.Thename)+"说：")]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t2 al gb"},[e._v(e._s(t.updataTime))]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t3 al gb"},[e._v(e._s(t.content))]):e._e()])})),n("div",{staticClass:"historyRecord"},[e._v("————历史纪录————")]),e._l(e.chatList,(function(t,s){return n("div",{key:s,staticClass:"chatMsg"},[t.adm!=e.admin?n("div",{staticClass:"chatMsg-t1"},[e._v(e._s(t.Thename)+"说：")]):e._e(),t.adm!=e.admin?n("div",{staticClass:"chatMsg-t2"},[e._v(e._s(t.updataTime))]):e._e(),t.adm!=e.admin?n("div",{staticClass:"chatMsg-t3"},[t.content?n("span",[e._v(e._s(t.content))]):e._e(),t.voice?n("span",{on:{click:function(n){return e.startVoice(t.voice)}}},[e._v("[点击播放语音]")]):e._e()]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t1 al gb"},[e._v(e._s(t.Thename)+"说：")]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t2 al gb"},[e._v(e._s(t.updataTime))]):e._e(),t.adm==e.admin?n("div",{staticClass:"chatMsg-t3 al gb"},[t.content?n("span",[e._v(e._s(t.content))]):e._e(),t.voice?n("span",{on:{click:function(n){return e.startVoice(t.voice)}}},[e._v("[点击播放语音]")]):e._e()]):e._e()])}))],2),n("div",{staticClass:"chat-page-bottom"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.con,expression:"con"}],attrs:{id:"",type:"text",name:""},domProps:{value:e.con},on:{input:function(t){t.target.composing||(e.con=t.target.value)}}}),e._v(" "),n("div",{staticClass:"sendop"},[n("div",{staticClass:"sendop-b1"},[n("button",{on:{click:function(t){e.show=!e.show}}},[e._v("颜艺")]),n("button",{on:{click:e.startRecord}},[e._v(e._s(e.isRecording?"录音中...":"点击录音"))])]),n("button",{on:{click:e.send}},[e._v("发送")])])]),n("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{staticClass:"emojBox"},e._l(e.emoji,(function(t,s){return n("div",{key:s,staticClass:"emojBox-items",on:{click:function(n){return e.selEmoj(t)}}},[e._v(" "+e._s(t)+" ")])})),0)])],1)},a=[],o=(n("53d1"),n("61ff")),i=(n("9cd1"),n("fd65")),c=(n("22ec"),n("bf33")),r=n("365c"),d=n("90fe"),m=n("caaf"),l=n.n(m),u=n("7b04"),h=n.n(u),p={components:{[c["a"].name]:c["a"],[i["a"].name]:i["a"],[o["a"].name]:o["a"]},data(){return{show:!1,emoji:["w(ﾟДﾟ)w","ヽ(✿ﾟ▽ﾟ)ノ","(๑•̀ㅂ•́)و✧","(⊙﹏⊙)","┗|｀O′|┛","φ(≧ω≦*)♪","凸(艹皿艹 )","╰(*°▽°*)╯","（´Д`）","(#`O′)","(＠_＠;)","(ー`´ー)"],num:"",histortist:[],chatList:[],admin:Object(d["b"])(),Thename:Object(d["a"])(),con:"",ws:null,hub:"",noAdm:"",isRecording:!1,localId:"",serverId:"",openVoice:"",signature:""}},beforeRouteLeave(e,t,n){this.ws.close(),n()},created(){const e=this;if(!Object(d["b"])()){Object(c["a"])("您尚未登陆，将随机分配您的用户名");let e=(new Date).valueOf();console.log(String(e)),this.noAdm="匿名用户"+String(e).substr(7,10),console.log(this.noAdm),this.admin=this.noAdm,this.Thename=this.noAdm}e.getlatest(),this.ws=new WebSocket("wss://www.shenyifan.top/socket/"),this.ws.onopen=function(){console.log("握手成功")},this.ws.onmessage=function(t){console.log("message:"+t.data),JSON.parse(t.data).content||JSON.parse(t.data).voice?(e.chatList.push(JSON.parse(t.data)),e.$nextTick((function(){var e=document.getElementById("msg_box");e.scrollTop=e.scrollHeight}))):e.num=t.data},this.ws.onerror=function(){Object(c["a"])("socket连接以断开，请刷新页面"),console.log("error")},setTimeout((function(){let t=l()().format("MMMM Do YYYY, h:mm:ss a"),n={adm:e.admin,Thename:e.Thename,content:e.Thename+"加入了聊天室",updataTime:t};e.ws.send(JSON.stringify(n))}),2e3)},mounted(){const e=this;e.signature=sessionStorage.getItem("wxsignature"),e.signature&&h.a.config({debug:!1,appId:"wx3352249676449b29",timestamp:"1414587457",nonceStr:"syf",signature:e.signature,jsApiList:["checkJsApi","getLocation","scanQRCode","openLocation","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"]}),h.a.onVoiceRecordEnd({complete:function(t){e.localId=t.localId,h.a.uploadVoice({localId:e.localId,isShowProgressTips:1,success:function(t){e.serverId=t.serverId,o["a"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(()=>{let t=l()().format("MMMM Do YYYY, h:mm:ss a"),n={adm:e.admin,Thename:e.Thename,content:"",updataTime:t,voice:e.serverId};e.ws.send(JSON.stringify(n))}).catch(()=>{})}})}})},methods:{send(){const e=this;if(e.isRecording)e.endAndSend();else{if(!this.con)return Object(c["a"])("请输入点什么"),!1;let t=l()().format("MMMM Do YYYY, h:mm:ss a"),n={adm:e.admin,Thename:e.Thename,content:String(e.con),updataTime:t};Object(r["r"])({admin:e.admin,content:e.con,Thename:e.Thename,updataTime:t}).then(e=>{}).catch(e=>{}),this.ws.send(JSON.stringify(n)),this.con=""}},getlatest(){const e=this;Object(r["s"])({}).then(t=>{console.log(t),e.histortist=t.data.errmsg,e.histortist.reverse(),console.log(e.histortist)}).catch(e=>{})},selEmoj(e){this.con=this.con+e,this.show=!1},startRecord(){const e=this;this.isRecording?e.endAndSend():(this.isRecording=!0,h.a.startRecord())},startVoice(e){const t=this;Object(c["a"])("录音下载中..."),h.a.downloadVoice({serverId:e,isShowProgressTips:1,success:function(e){t.openVoice=e.localId,Object(c["a"])("录音播放中，请开大音量:D"),h.a.playVoice({localId:t.openVoice})}})},endAndSend(){const e=this;this.isRecording=!1,h.a.stopRecord({success:function(t){e.localId=t.localId,h.a.uploadVoice({localId:e.localId,isShowProgressTips:1,success:function(t){e.serverId=t.serverId,o["a"].confirm({title:"提示",message:"音频上传好了，是否发送呢？"}).then(()=>{let t=l()().format("MMMM Do YYYY, h:mm:ss a"),n={adm:e.admin,Thename:e.Thename,content:"",updataTime:t,voice:e.serverId};e.ws.send(JSON.stringify(n))}).catch(()=>{})}})}})}}},v=p,f=(n("8923"),n("cba8")),g=Object(f["a"])(v,s,a,!1,null,null,null);t["default"]=g.exports}}]);